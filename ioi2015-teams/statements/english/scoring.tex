Let us denote $S$ by the sum of values of $M$ in all calls to \t{can(M, K)}.
\begin{center}
\begin{tabular}{|c|c|c|c|c|}
\hline
Subtask & Points & $N$ & $Q$ & Additional constraints\\
\hline
1 & 21 & $1 \le N \le 100$ & $1 \le Q \le 100$ & None \\
\hline
2 & 13 & $1 \le N \le 100\,000$ & $Q = 1$ & None \\
\hline
3 & 43 & $1 \le N \le 100\,000$ & $1 \le Q \le 100\,000$ & $S \le 100\,000$ \\
\hline
4 & 23 & $1 \le N \le 500\,000$ & $1 \le Q \le 200\,000$ & $S \le 200\,000$\\
\hline
\end{tabular}
\end{center}